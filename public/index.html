<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>æ¯’è‹¹æœæ¸¸æˆ</title>
  <style>
    #grid { display: grid; grid-template-columns: repeat(5, 50px); gap: 5px; }
    .apple { width: 50px; height: 50px; font-size: 30px; text-align: center; }
  </style>
</head>
<body>
  <h2>æ¯’è‹¹æœæ¸¸æˆ</h2>
  <div id="grid"></div>
  <p id="status">ç­‰å¾…å¦ä¸€ä½ç©å®¶...</p>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let playerNumber = null;
    let poisonSet = false;
    let canEat = false;

    const grid = document.getElementById('grid');
    const status = document.getElementById('status');

    for (let i = 0; i < 25; i++) {
      const btn = document.createElement('button');
      btn.className = 'apple';
      btn.textContent = 'ğŸ';
      btn.onclick = () => {
        if (!poisonSet) {
          socket.emit('setPoison', i);
        } else if (canEat) {
          socket.emit('eatApple', i);
          canEat = false;
        }
      };
      grid.appendChild(btn);
    }

    socket.on('playerNumber', num => {
      playerNumber = num;
      status.textContent = 'ä½ æ˜¯ç©å®¶ ' + num + 'ï¼Œç­‰å¾…å¦ä¸€ä½ç©å®¶...';
    });

    socket.on('poisonSet', () => {
      poisonSet = true;
      canEat = Math.random() < 0.5;
      status.textContent = canEat ? 'ä½ å…ˆåƒï¼Œé€‰ä¸€ä¸ªè‹¹æœ' : 'ç­‰å¾…å¯¹æ–¹é€‰æ‹©è‹¹æœ...';
    });

    socket.on('result', ({ index, isPoisoned }) => {
      const buttons = document.querySelectorAll('.apple');
      buttons[index].textContent = isPoisoned ? 'â˜ ï¸' : 'ğŸ˜‹';
      status.textContent = isPoisoned ? 'æ¯’å‘èº«äº¡ï¼Œæ¸¸æˆç»“æŸï¼' : 'å®‰å…¨ï¼Œè½®åˆ°å¯¹æ–¹ï¼';
    });
  </script>
</body>
</html>
